<%- include('../layouts/header.ejs') %>

    <body>
        
        <!-- nav bar -->
        <%- include('../layouts/navbar.ejs') %>
            <!-- navbar -->
             
            <main id="content" class="wrapper layout-page">
                <div class="dashboard-page-content">
                    <div class="row mb-9 align-items-center justify-content-between">
                        <div class="col-sm-6 mb-8 mb-sm-0">
                            <h2 class="fs-4 mb-0">Profile</h2>
                        </div>
                    </div>
                    
                    <div class="card mb-4 rounded-4 p-7">
                        <div class="card-body pt-7 pb-0 px-0">
                            <div class="row mx-n8">
                                <!-- sidbar  -->
                                <aside class="col-lg-3 border-end px-8">
                                    <nav class="nav nav-pills flex-lg-column mb-7 nav-add-product">
                                        <a class="nav-link active" id="profile-details-tab" data-bs-toggle="tab"
                                            href="#profile-details" aria-current="page">Profile Details</a>
                                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab"
                                            href="#orders">Orders</a>
                                        <a class="nav-link" id="wallet-tab" data-bs-toggle="tab"
                                            href="#wallet">Wallet</a>
                                        <a class="nav-link" id="address-tab" data-bs-toggle="tab"
                                            href="#address">Address</a>
                                        <a class="nav-link" id="password-change-tab" data-bs-toggle="tab"
                                            href="#password-change">Password Change</a>
                                    </nav>
                                    <div>
                                        <a class="btn btn-primary" href="/logout">Logout</a>
                                    </div>
                                </aside>
                                

                                <div class="col-lg-9 px-8">
                                    <section class="p-xl-8">
                                        <div class="tab-content">
                                            <div class="tab-pane fade show active" id="profile-details">
                                                <form class="form-border-1" action="/userProfile" method="post">
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <div class="row gx-9">
                                                                <div class="col-12 mb-6">
                                                                    <%// console.log(userDatas,'...................usewrsadata');
                                                                        %>
                                                                        <label
                                                                            class="mb-5 fs-13px ls-1 fw-semibold text-uppercase"
                                                                            for="name">Name</label>
                                                                        <input class="form-control" type="text"
                                                                            value="<%= userDatas.name %>" id="name"
                                                                            name="name">
                                                                </div>
                                                                <div class="col-12 mb-6">
                                                                    <label
                                                                        class="mb-5 fs-13px ls-1 fw-semibold text-uppercase"
                                                                        for="email">Email</label>
                                                                    <input class="form-control" type="email"
                                                                        value="<%= userDatas.email %>" id="email"
                                                                        name="email" readonly>
                                                                </div>
                                                                <div class="col-12 mb-6">
                                                                    <label
                                                                        class="mb-5 fs-13px ls-1 fw-semibold text-uppercase"
                                                                        for="phone">Phone</label>
                                                                    <input class="form-control" type="tel"
                                                                        value="<%= userDatas.mobile %>" id="phone"
                                                                        name="phone">
                                                                </div>
                                                                <div class="col-12 mb-6">
                                                                    <label
                                                                        class="mb-5 fs-13px ls-1 fw-semibold text-uppercase"
                                                                        for="code">Referral Code</label>
                                                                    <input class="form-control" type="text"
                                                                        value="<%= userDatas.refferalId %>" id="code"
                                                                        name="code" readonly>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <button class="btn btn-primary" type="submit">Edit</button>
                                                </form>


                                            </div>
                                            

                                            <div class="tab-pane fade" id="orders">
                                                
                                                <!-- Orders content here -->
                                                <h2>Your Orders</h2>
                                                <div class="card mb-4 rounded-4 p-7">
                                                    
                                                    <div class="card-body px-0 pt-7 pb-0">
                                                        <div class="table-responsive">
                                                            <table
                                                                class="table table-hover align-middle table-nowrap mb-0 table-borderless">
                                                                
                                                                <thead style="background-color: #343A40; color: #fff;">
                                                                    <tr>
                                                                        
                                                                        <th class="align-middle" scope="col">Items</th>
                                                                        <th class="align-middle" scope="col">Total Price
                                                                        </th>
                                                                        <th class="align-middle" scope="col">Status</th>
                                                                        <th class="align-middle" scope="col">Date</th>
                                                                        <th class="align-middle text-center"
                                                                            scope="col">Actions</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    
                                                                    <%// console.log(order,':order'); %>
                                                                        <% order.forEach(order=> { %>
                                                                            <% if(order.offer>0){ %>
                                                                                <% let
                                                                                    couponAmount=(order.offer/100)*order.orderAmount
                                                                                    %>

                                                                                    <% } %>
                                                                                    
                                                                                        <%order.products.forEach(product=>{%>
                                                                                            
                                                                                            <tr>
                                                                                                <td
                                                                                                    class="align-middle">
                                                                                                    <br>
                                                                                                    Qty: <%=
                                                                                                        product.quantity
                                                                                                        %>
                                                                                                </td>
                                                                                                <td
                                                                                                    class="align-middle">
                                                                                                    ₹ <%=
                                                                                                        product.productPrice
                                                                                                        *
                                                                                                        product.quantity
                                                                                                        %>.00
                                                                                                </td>
                                                                                                <td
                                                                                                    class="align-middle">
                                                                                                    <%= product.ProductStatus
                                                                                                        %>
                                                                                                </td>
                                                                                                <td
                                                                                                    class="align-middle">
                                                                                                    <%= new
                                                                                                        Date(order.orderDate).toLocaleDateString()
                                                                                                        %>
                                                                                                </td>
                                                                                                <td
                                                                                                    class="align-middle text-center">

                                                                                                    <a href="/singleOderDatas/<%= product._id %>"
                                                                                                        class="btn btn-primary">View</a>

                                                                                                </td>
                                                                                            </tr>
                                                                                            <% }) %>

                                                                                                <tr>
                                                                                                    <td colspan="5"
                                                                                                        class="text-end">
                                                                                                        <strong>Total
                                                                                                            Order
                                                                                                            Amount: ₹
                                                                                                            <%=order.orderAmount
                                                                                                                %>
                                                                                                                .00</strong>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                <% }) %>
                                                                                                                    
                                                                                    </tbody>
                                                                                    
                                                                                </table>

                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                    <%- include('../layouts/userPagination.ejs') %>

                                                                </div>

                                                            <div class="tab-pane fade" id="wallet">
                                                                <!-- Wallet content here -->
                                                                <h3>Your Wallet</h3>

                                                                <!-- Section for displaying current balance and adding money -->
                                                                <div class="p-5 justify-content-center d-flex ">
                                                                    <div class="walletBack w-75"
                                                                        style="border: 2px dotted rgb(251, 250, 250); padding:10px; margin:5px; border-radius: 5px;">
                                                                        <div>
                                                                            <h4>Current Balance <samp>: ₹ <%=walletDetail?.balance %>
                                                                                        </samp></h4>
                                                                        </div>
                                                                        <br>
                                                                        <!-- Form for adding money to the wallet -->
                                                                        <form action="/addWallet" method="post" id="myForm">
                                                                            <div class="row">
                                                                                <div class="col-md-4">
                                                                                    <input class="amount" id="amount" type="number"
                                                                                        name="walletAdd" placeholder="Enter Amount">
                                                                                </div>
                                                                                <input type="text" name="creditFail" hidden
                                                                                    value="success" id="creditFail">
                                                                                <div class="col-md-4 addButton">
                                                                                    <button class="btn btn-primary" type="button"
                                                                                        onclick="razorPay()">Add Money</button>
                                                                                </div>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>

                                                                <!-- Separate section for transaction details -->
                                                                <div class="p-5 justify-content-center d-flex">
                                                                    <div class="walletBack w-75"
                                                                        style="border: 2px solid rgb(178, 177, 177); padding:10px; margin:5px; border-radius: 5px;">
                                                                        <h4>Transaction History</h4>
                                                                        <table class="table table-striped">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Transactions</th>
                                                                                    <th>Amount</th>
                                                                                    <th>Date</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <% walletDetail?.transaction.forEach((Data)=> { %>
                                                                                    <tr>
                                                                                        <td>
                                                                                            <%= Data.creditOrDebit %>
                                                                                        </td>
                                                                                        <td>₹ <%= Data.amount %>
                                                                                        </td>
                                                                                        <td>
                                                                                            <%= Data.date.toLocaleDateString() %>
                                                                                        </td>
                                                                                    </tr>
                                                                                    <% }) %>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        <!-- Styles for the wallet section -->
                                                        <style>
                                                            .walletBack {
                                                                padding: 10px;
                                                                margin: 5px;
                                                                border-radius: 5px;
                                                            }

                                                            /* Dotted black border for Add Money section */
                                                            .walletBack:first-child {
                                                                border: 2px dotted rgb(252, 250, 250);
                                                            }

                                                            /* Plain white border for Transaction History section */
                                                            .walletBack:last-child {
                                                                border: 2px solid rgb(171, 170, 170);
                                                            }
                                                        </style>



                                            <!-- ........................................Address content here -->


                                            <div class="tab-pane fade" id="address">

                                                <h3>Your Address</h3>
                                                <div class="mb-7">

                                                    <div style="border-radius: 10px; " id="addressCard"
                                                        class="address-card">
                                                        <div class="title"
                                                            style="text-align: center; margin-bottom: 0.5rem;">
                                                            <h5 style="margin: 0;">Address</h5>
                                                        </div>
                                                        <% if (addresses && addresses.address && addresses.address.length> 0) { %>
                                                            <% addresses.address.forEach((value)=>{%>
                                                                <div class="address-content"
                                                                    style="font-family: Arial, sans-serif; line-height: 1.6;  border-radius: 10px; border: 1px dashed gray; padding: 1rem; margin-bottom: 1rem;">
                                                                    <div
                                                                        style="display: flex; flex-direction: row-reverse;">

                                                                    </div>
                                                                    <p style="margin: 0;">
                                                                        <span style="font-weight: bold;">
                                                                            <%=value.name %>
                                                                        </span><br>
                                                                        <%= value.street %>, <%= value.locality %><br>
                                                                                <%= value.city %>, <%= value.state %>,
                                                                                        <%= value.pincode %><br>
                                                                                            Phone: <%= value.phone %>
                                                                    </p>
                                                                    <div>
                                                                        <button
                                                                            class="btn btn-dark btn-hover-bg-primary btn-hover-border-primary px-2 mt-md-4 mt-2"
                                                                            style=" bottom: 10px; left: 10px; padding: 0.2rem 0.5rem; font-size: 0.7rem;"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#editAddress"
                                                                            onclick="editAddress('<%=value._id%>')">Edit
                                                                            Address</button>
                                                                        <button
                                                                            class="btn btn-dark btn-hover-bg-primary btn-hover-border-primary px-2 mt-md-4 mt-2"
                                                                            style=" bottom: 10px; left: 10px; padding: 0.2rem 0.5rem; font-size: 0.7rem;"
                                                                            onclick="remove('<%=value._id%>')">Remove</button>

                                                                    </div>
                                                                </div>
                                                                
                                                                <%})%>
                                                                    <% } else { %>
                                                                        <p>No addresses found</p>
                                                                        <% } %>


                                                                            <button
                                                                                class="btn btn-dark btn-hover-bg-primary btn-hover-border-primary px-11 mt-md-7 mt-4"
                                                                                data-bs-toggle="modal"
                                                                                data-bs-target="#addAddress">Add
                                                                                Address</button>



                                                                            <nav aria-label="Page navigation example"
                                                                                class="mt-6 mb-4">
                                                                                <ul class="pagination justify-content-start">
                                                                                    <% if (pages> 1) { %>
                                                                                        <li class="page-item mx-3">
                                                                                            <a class="page-link"
                                                                                                href="?page=<%= pages - 1 %>">Prev</a>
                                                                                        </li>
                                                                                        <% } %>

                                                                                            <% for (let i=1; i<=totalPagess; i++) { %>
                                                                                                <li
                                                                                                    class="page-item <%= pages == i ? 'active' : '' %> mx-3">
                                                                                                    <a class="page-link"
                                                                                                        href="?page=<%= i %>">
                                                                                                        <%= i %>
                                                                                                    </a>
                                                                                                </li>
                                                                                                <% } %>
                                                                                                <% if (pages < totalPagess) { %>
                                                                                                    <li class="page-item mx-3">
                                                                                                        <a class="page-link"
                                                                                                            href="?page=<%= pages + 1 %>">Next</a>
                                                                                                    </li>
                                                                                                    <% } %>
                                                                                </ul>
                                                                            </nav>




                                                                            <!--......................... add address modal...............................-->

                                                                            <div class="modal" id="addAddress"
                                                                                tabindex="-1">
                                                                                <div class="modal-dialog">
                                                                                    <div class="modal-content">
                                                                                        <div class="modal-header">
                                                                                            <h5 class="modal-title">Add
                                                                                                Address</h5>
                                                                                            <button type="button"
                                                                                                class="btn-close"
                                                                                                data-bs-dismiss="modal"
                                                                                                aria-label="Close"></button>
                                                                                        </div>
                                                                                        <div class="modal-body">
                                                                                            <form id="addressForm"
                                                                                                action="/addAddress"
                                                                                                method="post"
                                                                                                onsubmit="return validateForm(event)">
                                                                                                <div class="mb-7">
                                                                                                    <div class="row">
                                                                                                        <div
                                                                                                            class="col-md-6 mb-md-0 mb-7">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Name</label>
                                                                                                            <input
                                                                                                                type="text"
                                                                                                                class="form-control"
                                                                                                                id="firstName"
                                                                                                                name="name"
                                                                                                                placeholder="First Name"
                                                                                                                required>
                                                                                                            <div id="nameError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="col-md-6 mb-md-0 mb-7">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Phone</label>
                                                                                                            <input
                                                                                                                type="number"
                                                                                                                class="form-control"
                                                                                                                id="phone"
                                                                                                                name="phone"
                                                                                                                placeholder="Phone Number"
                                                                                                                required>
                                                                                                            <div id="numberError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div class="mb-7">
                                                                                                    <div class="row">
                                                                                                        <div
                                                                                                            class="col-md-8 mb-md-0 mb-7">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Street
                                                                                                                Address</label>
                                                                                                            <input
                                                                                                                type="text"
                                                                                                                class="form-control"
                                                                                                                id="streetAddress"
                                                                                                                name="street"
                                                                                                                placeholder="Street Address"
                                                                                                                required>
                                                                                                            <div id="streetError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div class="mb-7">
                                                                                                    <div class="row">
                                                                                                        <div
                                                                                                            class="col-md-4 mb-md-0 mb-7">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Locality</label>
                                                                                                            <input
                                                                                                                type="text"
                                                                                                                class="form-control"
                                                                                                                id="locality"
                                                                                                                name="locality"
                                                                                                                placeholder="Locality"
                                                                                                                required>
                                                                                                            <div id="localityError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="col-md-4 mb-md-0 mb-7">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">State</label>
                                                                                                            <input
                                                                                                                type="text"
                                                                                                                class="form-control"
                                                                                                                id="state"
                                                                                                                name="state"
                                                                                                                placeholder="State"
                                                                                                                required>
                                                                                                            <div id="stateError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="col-md-4">
                                                                                                            <label
                                                                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Pin
                                                                                                                Code</label>
                                                                                                            <input
                                                                                                                type="number"
                                                                                                                class="form-control"
                                                                                                                id="pincode"
                                                                                                                name="pincode"
                                                                                                                placeholder="Pin Code"
                                                                                                                required>
                                                                                                            <div id="pincodeError"
                                                                                                                class="text-danger">
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div class="mb-7">
                                                                                                    <label
                                                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">City</label>
                                                                                                    <div
                                                                                                        class="bg-body-secondary rounded">
                                                                                                        <input
                                                                                                            type="text"
                                                                                                            class="form-control"
                                                                                                            id="city"
                                                                                                            name="city"
                                                                                                            placeholder="City"
                                                                                                            required>
                                                                                                        <div id="cityError"
                                                                                                            class="text-danger">
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="modal-footer">
                                                                                                    <button
                                                                                                        type="button"
                                                                                                        class="btn btn-secondary"
                                                                                                        id="CloseId"
                                                                                                        data-bs-dismiss="modal">Close</button>
                                                                                                    <button
                                                                                                        type="submit"
                                                                                                        class="btn btn-primary"
                                                                                                        >Add
                                                                                                    </button>
                                                                                                </div>
                                                                                            </form>
                                                                                        </div>

                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                    </div>

                                                </div>

                                                <!--........................ address end here..................................-->

                                            </div>
                                        </div>
                                        

                                        <!-- ...............................edit address.......................................... -->

                                        <div class="modal" id="editAddress" tabindex="-1">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Modal title</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input type="hidden" id="addressId" name="addressId" value="">
                                                        <div class="mb-7">

                                                            <div class="row">
                                                                <div class="col-md-6 mb-md-0 mb-7">
                                                                    <label
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">name</label>
                                                                    <input type="text" class="form-control"
                                                                        id="editName" name="name"
                                                                        placeholder="First Name" value="" required>
                                                                    <div id="nameError" class="text-danger"></div>
                                                                </div>

                                                                <div class="col-md-6 mb-md-0 mb-7">
                                                                    <label
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Phone</label>
                                                                    <input type="tel" class="form-control"
                                                                        id="editphone" name="phone"
                                                                        placeholder="Phone number" required>
                                                                    <div id="numberError" class="text-danger"></div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                        <div class="mb-7">
                                                            <div class="row">
                                                                <div class="col-md-8 mb-md-0 mb-7">
                                                                    <label for="street-address"
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">Street
                                                                        Address</label>
                                                                    <input type="text" class="form-control"
                                                                        id="editstreetAddress" name="street" required>
                                                                    <div id="streetError" class="text-danger"></div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                        <div class="mb-7">
                                                            <div class="row">
                                                                <div class="col-md-4 mb-md-0 mb-7">
                                                                    <label for="city"
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">locality</label>
                                                                    <input type="text" class="form-control"
                                                                        id="editlocality" name="locality" required>
                                                                    <div id="localityError" class="text-danger"></div>
                                                                </div>
                                                                <div class="col-md-4 mb-md-0 mb-7">
                                                                    <label for="state"
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">State</label>
                                                                    <input type="text" class="form-control"
                                                                        id="editstate" name="state" required>
                                                                    <div id="stateError" class="text-danger"></div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <label for="zip"
                                                                        class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">pin
                                                                        code</label>
                                                                    <input type="number" class="form-control"
                                                                        id="editpincode" name="pincode" required>
                                                                    <div id="pincodeError" class="text-danger"></div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-7">
                                                            <label
                                                                class="mb-5 fs-13px letter-spacing-01 fw-semibold text-uppercase">city</label>
                                                            <div class=" bg-body-secondary rounded">
                                                                <input type="text" class="form-control" id="editcity"
                                                                    name="city" required>
                                                                <div id="cityError" class="text-danger">

                                                                </div>
                                                                <p id="editEmptyError" class="text-danger"></p>

                                                            </div>
                                                        </div>
                                                        <div class="mb-7">

                                                            <div class="row">


                                                            </div>
                                                        </div>



                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" id="CloseId"
                                                            data-bs-dismiss="modal">Close</button>
                                                        <button type="button" class="btn btn-primary"
                                                            onclick="saveEditAddress()">Save Changes</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- .................................edit address end here................................... -->


                                        <!-- .................................password change here................................... -->


                                        <div class="tab-pane fade" id="password-change">
                                            <!-- Password Change content here -->
                                            <h3>Change Password</h3>
                                            <form id="passwordChangeForm">
                                                <div class="mb-3">
                                                    <label for="current-password" class="form-label">Current
                                                        Password</label>
                                                    <input type="password" class="form-control" id="currentPassword"
                                                        name="currentPassword" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="newPassword" class="form-label">New Password</label>
                                                    <input type="password" class="form-control" id="newPassword"
                                                        name="newPassword" required>
                                                </div>
                                                <button type="submit" id="saveChangesButton"
                                                    class="btn btn-primary">Save Changes</button>
                                            </form>
                                        </div>


                                    </section>
                                    
                                </div>
                                
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
                

            </main>
            
            <style>
                .amount {
                    /* box-shadow:1px 1px 1px 8px rgb(219, 211, 211); */
                    width: 100%;
                    height: 3rem;
                    border-radius: 10px;
                    background-color: #343a40;
                    border: 0;
                }



                body {

                    height: 100vh;

                }

                .select-menu {
                    width: 300px;
                    cursor: pointer;
                    position: relative;
                }

                .select {
                    border: 1px solid;
                    padding: 10px;
                    color: #8b928e;
                    font-weight: 500;
                    border-radius: 6px;
                    display: -webkit-box;
                    display: -ms-flexbox;
                    display: flex;



                    -webkit-box-pack: justify;
                    -ms-flex-pack: justify;
                    justify-content: space-between;
                }

                .options-list {
                    position: absolute;
                    width: 100%;
                    background-color: #343a40;
                    border-radius: 6px;

                    padding: 0 20px;

                    overflow-y: auto;
                    -webkit-transition: .4s linear .2s;
                    -o-transition: .4s linear .2s;
                    transition: .4s linear .2s;
                    height: 0;
                }

                .option {
                    padding: 8px 0;
                    font-weight: 500;
                    font-size: 14px;
                    -webkit-transition: .3s ease-in-out;
                    -o-transition: .3s ease-in-out;
                    transition: .3s ease-in-out;
                }



                .options-list::-webkit-scrollbar {
                    width: 4px;
                    background-color: #eee;
                }



                .options-list.active {
                    height: 180px;
                }
            </style>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

            <script>
                document.getElementById('passwordChangeForm').addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;

                    try {
                        const response = await fetch('/changePassword', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ currentPassword, newPassword }),
                        });

                        const result = await response.json();

                        if (result.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: result.message,
                                icon: 'success',
                                confirmButtonText: 'OK',
                            }).then(() => {
                                window.location.href = '/myAccount';
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: result.message,
                                icon: 'error',
                                confirmButtonText: 'OK',
                            });
                        }
                    } catch (error) {
                        Swal.fire({
                            title: 'Error!',
                            text: 'An unexpected error occurred. Please try again later.',
                            icon: 'error',
                            confirmButtonText: 'OK',
                        });
                    }
                });
            </script>



            <script>
                const select = document.querySelector(".select");
                const options_list = document.querySelector(".options-list");
                const options = document.querySelectorAll(".option");

                //show & hide options list
                select.addEventListener("click", () => {
                    options_list.classList.toggle("active");
                    select.querySelector(".fa-angle-down").classList.toggle("fa-angle-up");
                });

                //select option
                options.forEach((option) => {
                    option.addEventListener("click", () => {
                        options.forEach((option) => { option.classList.remove('selected') });
                        select.querySelector("span").innerHTML = option.innerHTML;
                        option.classList.add("selected");
                        options_list.classList.toggle("active");
                        select.querySelector(".fa-angle-down").classList.toggle("fa-angle-up");
                    });
                })
            </script>


            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

            <script>

                let paymentInProcess = false;
                function razorPay() {
                    if (paymentInProcess) return;
                    paymentInProcess = true;
                    const form = document.getElementById('myForm');
                    const amount = document.getElementById('amount');
                    const addFailed = document.getElementById('creditFail');

                    fetch('/razors', {
                        method: 'POST',
                        headers: { 'Content-type': 'application/json' },
                        body: JSON.stringify({ amount: amount.value })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                let options = {
                                    "key": data.key_id,
                                    "amount": data.amount,
                                    "currency": "INR",
                                    "name": "GLOWING",
                                    "handler": function (response) {
                                        form.submit();
                                    },
                                    "profile": {
                                        "name": data.name,
                                        "email": data.email
                                    }
                                };

                                let razorpayObject = new Razorpay(options);

                                // Handle payment failure
                                razorpayObject.on('payment.failed', (response) => {
                                    if (paymentInProcess) {  // Ensure this block is only executed once
                                        addFailed.value = 'failed';

                                        fetch('/walletFail', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({ amount: amount.value })
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                if (data.success) {
                                                    Swal.fire({
                                                        icon: 'error',
                                                        title: 'Payment Failed',
                                                        text: 'Some issues happened while processing your payment. Please try again.',
                                                        confirmButtonText: 'Return to Checkout',
                                                        background: '#31363F'
                                                    }).then(() => {
                                                        window.location.href = '/myAccount';
                                                    });
                                                }
                                            })
                                            .finally(() => {
                                                paymentInProcess = false;
                                            });
                                    }
                                });

                                razorpayObject.open();
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            paymentInProcess = false;
                        });
                }



                async function editAddress(editId) {
                    const name = document.getElementById('editName')
                    const phone = document.getElementById('editphone')
                    const street = document.getElementById('editstreetAddress')
                    const locality = document.getElementById('editlocality')
                    const state = document.getElementById('editstate')
                    const pincode = document.getElementById('editpincode')
                    const city = document.getElementById('editcity')
                    const addressId = document.getElementById('addressId')

                    try {
                        const response = await axios.post('/editAddress', { editId })
                        const data = response.data
                        if (data) {
                            name.value = data.name
                            phone.value = data.phone
                            street.value = data.street
                            locality.value = data.locality
                            state.value = data.state
                            pincode.value = data.pincode
                            city.value = data.city
                            addressId.value = data.addressId
                        }
                    } catch (error) {
                        console.log(error.message);

                    }
                }




                async function saveEditAddress() {
                    const name = document.getElementById('editName').value;
                    const phone = document.getElementById('editphone').value;
                    const street = document.getElementById('editstreetAddress').value;
                    const locality = document.getElementById('editlocality').value;
                    const state = document.getElementById('editstate').value;
                    const pincode = document.getElementById('editpincode').value;
                    const city = document.getElementById('editcity').value;
                    const addressId = document.getElementById('addressId').value;


                    Swal.fire({
                        title: "Are you sure?",
                        text: "Want to make changes?",
                        icon: "warning",
                        confirmButtonText: "Yes",
                        confirmButtonColor: "#3085d6",
                        showCancelButton: true,
                        cancelButtonColor: "#d33"
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const response = await axios.patch('/saveEdit', {
                                    addressId,
                                    name,
                                    phone,
                                    pincode,
                                    state,
                                    street,
                                    locality,
                                    city
                                });

                                if (response.data.loginRequired) {
                                    window.location.href = '/login';
                                } else if (response.data.error) {
                                    Swal.fire({
                                        position: "center",
                                        icon: "error",
                                        title: response.data.error,
                                        showConfirmButton: false,
                                        timer: 2000
                                    });
                                } else if (response.data.success) {
                                    Swal.fire({
                                        position: "center",
                                        icon: "success",
                                        title: "Address Edited!",
                                        showConfirmButton: false,
                                        timer: 1500
                                    }).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    console.error("Unexpected response from server:", response.data);
                                }
                            } catch (error) {
                                console.error("Error occurred while editing address:", error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'An error occurred while editing the address.',
                                });
                            }
                        }
                    });
                }

                async function remove(ID) {
                    Swal.fire({
                        title: "Are you sure?",
                        text: "Do you want to delete address?",
                        icon: "warning",
                        confirmButtonText: "Yes",
                        confirmButtonColor: "#3085d6",
                        showCancelButton: true,
                        cancelButtonColor: "#d33"
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const response = await axios.patch('/removePfAddress', { ID })
                                if (response.data.loginRequired) {
                                    window.location.href = '/login';
                                } else if (response.data.error) {
                                    Swal.fire({
                                        position: "center",
                                        icon: "error",
                                        title: response.data.error,
                                        showConfirmButton: false,
                                        timer: 2000
                                    });
                                } else if (response.data.success) {
                                    Swal.fire({
                                        title: 'Success!',
                                        text: 'address deleted successfully!',
                                        icon: 'success',
                                        confirmButtonText: 'OK'
                                    }).then(() => {
                                        window.location.reload()
                                    })
                                } else {
                                    console.error("Unexpected response from server:", response.data);
                                }
                            } catch (error) {
                                console.error("Error occurred while deleting address:", error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'An error occurred while deleting the address.',
                                });
                            }
                        }
                    })

                }


                function validateForm(event) {
                    event.preventDefault();
                    console.log('address here');
                    
                    document.getElementById("nameError").textContent = "";
                    document.getElementById("numberError").textContent = "";
                    document.getElementById("streetError").textContent = "";
                    document.getElementById("localityError").textContent = "";
                    document.getElementById("stateError").textContent = "";
                    document.getElementById("pincodeError").textContent = "";
                    document.getElementById("cityError").textContent = "";

                    let isValid = true;


                    const name = document.getElementById('firstName').value.trim();
                    
                    if (name === '' || /\d/.test(name) || /[^\w\s]/.test(name) || /\s/.test(name) || name !== name.replace(/\s+/g, ' ')) {
                        document.getElementById('nameError').textContent = 'Please enter a valid name';
                        isValid = false;
                    }


                    const phonee = document.getElementById('phone').value.trim()
                    const phoneRegex = /^\d{10}$/;
                    if (!phoneRegex.test(phonee)) {
                        document.getElementById('numberError').textContent = 'Enter valid number'
                        isValid = false;
                    }


                    const pinCode = document.getElementById('pincode').value.trim()
                    const pincodeRegex = /^[0-9]{6}$/;
                    if (!pincodeRegex.test(pinCode)) {
                        document.getElementById('pincodeError').textContent = 'Please enter valid 6-digit pin code '
                        isValid = false;
                    }

                    if (isValid) {
                        document.getElementById('addressForm').submit()

                    }
                }


            </script>

            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

            <!-- footer -->
            <%- include('../layouts/footer.ejs') %>
                <!-- footer -->
                <!-- layout footer -->

                <!-- layout footer -->
                <%- include('../layouts/layoutFooter.ejs') %>
                    <!--layoutFooter  -->

                    <!-- svg -->
                    <%- include('../layouts/svg.ejs') %>
                        <!-- svg -->

                        <!-- search  -->
                        <%- include('../layouts/search.ejs') %>
                            <!-- search -->

                            <!-- mobile nav bar -->
                            <%- include('../layouts/mobileNavbar.ejs') %>
                                <!-- mobile nav bar -->


                                <div class="position-fixed z-index-10 bottom-0 end-0 p-10">
                                    <a href="#"
                                        class="gtf-back-to-top text-decoration-none bg-body text-primary bg-primary-hover text-light-hover shadow square p-0 rounded-circle d-flex align-items-center justify-content-center"
                                        title="Back To Top" style="--square-size: 48px"><i
                                            class="fa-solid fa-arrow-up"></i></a>
                                </div>
    </body>

    <!-- Mirrored from templates.g5plus.net/glowing-bootstrap-5/home-02.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Mar 2024 11:45:35 GMT -->

    </html>